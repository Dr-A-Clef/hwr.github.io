<!DOCTYPE html><html lang="zh-CN"><!-- Head tag --><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="renderer" content="webkit|ie-comp|ie-stand"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><title>Hexo折腾笔记 - BUG研发中心</title><meta name="keywords" content=""><meta name="description" content="Warning: inexperienced programmer inside!"><meta name="author" content="Dr. A. Clef"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><link href="/css/style.css" rel="stylesheet" type="text/css"><link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><script type="text/javascript">"jQuery"in window||(window._jqQ=[],window.jQuery=window.$=function(){_jqQ.push(arguments)});</script><script id="jquery-src" src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" async onload="_jqQ.forEach(function(n){$.apply($,n)}),delete window._jqQ"></script><script src="/js/script.js" type="text/javascript" async></script><!-- Global javascript config object --><script type="text/javascript">var CONFIG={disqus:{api_key:"1PwNiUJfZNlIZGUH0d0ZfKyOBXhdTclO1F9BJqRJDjcrJ5JVGe45C7YAQO0L5lFc",forum:"unnamed42-github"}};</script><script type="text/javascript">!function(){var t=document,e=t.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://unnamed42-github.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><script src="/js/disqus.js" type="text/javascript" defer="defer"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({showProcessingMessages:!1,jax:["input/TeX","output/HTML-CSS","output/PreviewHTML"],extensions:["tex2jax.js","fast-preview.js","AssistiveMML.js"],TeX:{extensions:["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]},tex2jax:{inlineMath:[["$","$"]],displayMath:[["$$","$$"]],processEscapes:!0,skipTags:["script","noscript","style","textarea","pre","code"]},"HTML-CSS":{linebreaks:{automatic:!0}}});</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.2/MathJax.js?config=TeX-AMS_SVG" async></script><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script></head><body class="post"><nav id="header"><div class="container clearfix"><div class="logo" style="width:auto"><a href="/" title="BUG研发中心" rel="home" style="text-decoration:none"><span class="brand-logo">BUG研发中心</span></a></div><div id="global-nav"><ul class="gnul"><li class="gnli"><a class="gna fa fa-home" href="/" title="BUG研发中心"><span class="gn-item">主页</span></a></li><li class="gnli dropdown current"><a class="gna fa fa-bars" href="#"><span class="gn-item">导航</span></a><div class="submenu"><div class="tab-content"><table><tbody><tr class="trline"><td class="tdleft">分类</td><td class="tdright"><ul class="tab-categories"><li class="cat-item"><a href="/categories/学习/">学习</a></li><li class="cat-item"><a href="/categories/杂项/">杂项</a></li><li class="cat-item"><a href="/categories/生活娱乐/">生活娱乐</a></li><li class="cat-item"><a href="/categories/编程/">编程</a></li></ul></td></tr><tr><td class="tdleft">标签</td><td class="tdright"><div class="tab-tags"><a href="/tags/笑话/" style="font-size:12px">笑话</a> <a href="/tags/Hexo/" style="font-size:12px">Hexo</a> <a href="/tags/Markdown/" style="font-size:12px">Markdown</a> <a href="/tags/GitHub/" style="font-size:12px">GitHub</a> <a href="/tags/Leetcode/" style="font-size:12px">Leetcode</a> <a href="/tags/算法/" style="font-size:12px">算法</a> <a href="/tags/MathJax/" style="font-size:12px">MathJax</a> <a href="/tags/配置/" style="font-size:12px">配置</a> <a href="/tags/情感叙事/" style="font-size:12px">情感叙事</a> <a href="/tags/插件/" style="font-size:12px">插件</a> <a href="/tags/测试/" style="font-size:12px">测试</a> <a href="/tags/DnD/" style="font-size:12px">DnD</a> <a href="/tags/VPS/" style="font-size:12px">VPS</a></div></td></tr></tbody></table></div></div></li><li class="gnli"><a class="gna fa fa-archive" href="/archives/index.html"><span class="gn-item">归档</span></a></li><li class="gnli"><a class="gna fa fa-user" href="/about/index.html"><span class="gn-item">关于</span></a></li><li class="gnli"><a class="gna fa fa-rss" href="/atom.xml"><span class="gn-item">订阅</span></a></li></ul></div><form id="search-form" action="/search.html"><input name="keywords" id="search-input" placeholder="输入关键词"> <button type="submit" id="search-submit"><span class="fa fa-search"></span></button></form></div></nav><main id="content"><div class="container clearfix"><div id="primary" class="has-toc"><nav class="breadcrumb-navigation"><a rel="bookmark" href="/">主页</a> <span class="breadcrumb-arrow fa fa-angle-right"></span> <a href="/categories/学习/" title="学习" rel="category tag">学习</a> <span class="breadcrumb-arrow fa fa-angle-right"></span> Hexo折腾笔记</nav><article class="single-post"><header class="post-header"><h1 class="post-title"><a href="/2016-09-10-Hexo折腾笔记.html" title="Hexo折腾笔记">Hexo折腾笔记</a></h1></header><div class="post-meta"><ul class="inline-ul"><li class="inline-li"><time>2016-09-10</time></li><li class="inline-li"><span class="post-span">·</span></li><li class="inline-li"><a href="/categories/学习/" title="学习" rel="category tag">学习</a></li><li class="inline-li"><span class="post-span">·</span></li><li class="inline-li"><span id="busuanzi_value_page_pv"></span> Views</li></ul></div><div class="post-body clearfix"><div class="post-content"><p>身为一名预备程序员，对于自己使用的工具自然要有折腾的欲望。从今年<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>七八月以来，就一直在想着如何折腾折腾Hexo. 再加上很喜欢<a href="https://mufeng.me/wordpress-mobile-theme-kunkka.html" target="_blank" rel="noopener">Kunkka</a>（其Github源已404，估计被作者自己删除了）这个Wordpress的主题，想着把它移植到Hexo上来。就在这里记载一下碰到的问题和解决方案吧。</p><p>UPDATE 2016/10/28: 修改了部分用词</p><p>UPDATE 2017/9/22: 更新代码</p><a id="more"></a><h2 id="主题的创建">主题的创建</h2><p>方便起见，我在主题中插入了<a href="https://jquery.com/" target="_blank" rel="noopener">jQuery</a>和<a href="http://fontawesome.io/" target="_blank" rel="noopener">FontAwesome</a>. 实际上，没有这两样我浑身难受。</p><h3 id="主题模板引擎">主题模板引擎</h3><p>Hexo主要提供了三款模板引擎，分别是<a href="http://www.embeddedjs.com/" target="_blank" rel="noopener">EJS</a>, <a href="https://naltatis.github.io/jade-syntax-docs/" target="_blank" rel="noopener">Jade</a>(现名<a href="https://pugjs.org/api/getting-started.html" target="_blank" rel="noopener">Pug</a>), <a href="http://www.swig.org/" target="_blank" rel="noopener">Swig</a>.</p><p>我个人看来，Jade代码结构优雅（和Python一样，不优雅不让跑），但是代码结构和HTML文档相去甚远，非常不直观。这也就意味着，要使用它不光要学习HTML, 还得特别地去学习Jade语法。而且据我本人少量的测试而言，Jade的主题和EJS的主题相比生成速度慢了几倍。EJS duang的一下就生成完了，Jade你还能在终端里看着它慢慢地一行一行的输出生成了xxx文件。</p><p>而EJS和Swig两个相比，在我使用的功能上我感觉不出什么差别。两个都和世界上最好的语言<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>一样，动态生成的部分穿插在HTML当中。不过，Swig在npm上已经没人维护了。</p><p>我本人使用的是EJS, 它脚本部分全盘使用Javascript语法，生成快，学起来也快，而且在之前有<ruby>改进<rp>(</rp><rt>xiā gǎi</rt><rp>)</rp></ruby><a href="https://github.com/unnamed42/hexo-theme-Anisina" target="_blank" rel="noopener">Anisina</a>的经验（它是用EJS写的）。最最重要的是，我使用的文本编辑器<a href="https://kate-editor.org/" target="_blank" rel="noopener">Kate</a>有它的高亮文件。这一点非常非常非常重要。</p><h3 id="主题css预处理器">主题CSS预处理器</h3><p>Hexo 所支持的CSS预处理器有<a href="http://sass-lang.com/" target="_blank" rel="noopener">Sass</a>, <a href="http://stylus-lang.com/" target="_blank" rel="noopener">Stylus</a>, <a href="http://lesscss.org/" target="_blank" rel="noopener">Less</a>三款。另两个我没用过，不过Stylus功能绝对够多够强，够用了。</p><p>你要是不嫌麻烦，也可以不使用预处理器，直接莽原生CSS也是可以的。</p><h3 id="主题结构">主题结构</h3><p>这些在Hexo的文档(<a href="https://hexo.io/docs/themes.html" target="_blank" rel="noopener">Theme</a>, <a href="https://hexo.io/docs/templates.html" target="_blank" rel="noopener">Template</a>)里都有描写，虽然不是很详细，但也够用了。</p><h2 id="hexo主题相关">Hexo主题相关</h2><h3 id="回到顶部-按钮">“回到顶部”按钮</h3><h4 id="按钮样式">按钮样式</h4><p>刚开始我是仿自<a href="https://github.com/tufu9441/maupassant-hexo" target="_blank" rel="noopener">Maupassant</a>使用一个小按钮来实现“回到顶部”，而且当滚动到一定位置时才出现。</p><p>这一个按钮由以下部分组成：</p><figure class="highlight plain"><figcaption><span>totop.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;totop&quot; class&gt;</span><br><span class="line">    &lt;button class=&quot;button button-square button-small&quot; title=&lt;%- __(&apos;to_top&apos;)%&gt;&gt;&lt;i class=&quot;fa fa-chevron-up&quot;&gt;&lt;/i&gt;&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p><code>button</code>, <code>button-square</code>, <code>button-small</code>是我引自<a href="http://www.bootcss.com/p/buttons/" target="_blank" rel="noopener">BUTTONS</a>的按钮样式（感谢<a href="https://github.com/MaoKwen" target="_blank" rel="noopener">@maokwen</a>的推荐），你也可以使用其他的按钮样式。</p><figure class="highlight css"><figcaption><span>totop.css</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#totop</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">visibility</span>: hidden;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">-webkit-transition</span>: visibility <span class="number">0.2s</span>, opacity <span class="number">0.2s</span> linear;</span><br><span class="line">     <span class="attribute">-moz-transition</span>: visibility <span class="number">0.2s</span>, opacity <span class="number">0.2s</span> linear;</span><br><span class="line">          <span class="attribute">transition</span>: visibility <span class="number">0.2s</span>, opacity <span class="number">0.2s</span> linear;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#totop</span><span class="selector-class">.display</span> &#123;</span><br><span class="line">  <span class="attribute">visibility</span>: visible;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><figcaption><span>totop.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123; </span><br><span class="line"><span class="comment">// When to show the scroll link</span></span><br><span class="line"><span class="comment">// higher number = scroll link appears further down the page   </span></span><br><span class="line"><span class="keyword">var</span> upperLimit = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Our scroll link element</span></span><br><span class="line"><span class="keyword">var</span> scrollElem = $(<span class="string">'#totop'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Scroll to top speed</span></span><br><span class="line"><span class="keyword">var</span> scrollSpeed = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Show and hide the scroll to top link based on scroll position   </span></span><br><span class="line">$(<span class="built_in">window</span>).scroll(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ( $(<span class="built_in">document</span>).scrollTop() &gt; upperLimit ) &#123;</span><br><span class="line">        $(scrollElem).addClass(<span class="string">"display"</span>); <span class="comment">// fade back in           </span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $(scrollElem).removeClass(<span class="string">"display"</span>); <span class="comment">// fade out</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Scroll to top animation on click</span></span><br><span class="line">$(scrollElem).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="string">'html, body'</span>).animate(&#123;<span class="attr">scrollTop</span>:<span class="number">0</span>&#125;, scrollSpeed); <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;)(jQuery);</span><br></pre></td></tr></table></figure><p>将其插入到合适的地方即可。</p><h4 id="百分比样式">百分比样式</h4><p>后来看见了<a href="https://lijiancheng0614.github.io" target="_blank" rel="noopener">lijiancheng0614</a>使用的<a href="https://lijiancheng0614.github.io/2015/08/15/2015_08_15_Migrate_to_Hexo/#%E6%B7%BB%E5%8A%A0gotop" target="_blank" rel="noopener">百分比样式</a>，我感觉它更强，于是换用了这个。</p><p>这个按钮是一个圆形按钮，并且有一个实时更新的圆形进度条显示你当前阅读进度。虽然功能更强，但代码量更大，性能损耗更多。具体如何取舍看你自己了。</p><figure class="highlight plain"><figcaption><span>totop.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;backtoTop&quot; data-action=&quot;gototop&quot; title=&quot;&lt;%- __(&apos;to_top&apos;) %&gt;&quot;&gt;</span><br><span class="line">    &lt;canvas id=&quot;backtoTopCanvas&quot; width=&quot;48&quot; height=&quot;48&quot;&gt;&lt;/canvas&gt;</span><br><span class="line">    &lt;div class=&quot;percentage&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><figure class="highlight stylus"><figcaption><span>totop.styl</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">#bac</span>ktoTop &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#eee</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">5%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">48px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">48px</span>;</span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">right</span>: -<span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">99</span>;</span><br><span class="line">    -webkit-<span class="attribute">transition</span>: <span class="number">0.5s</span>;</span><br><span class="line">       -moz-<span class="attribute">transition</span>: <span class="number">0.5s</span>;</span><br><span class="line">            <span class="attribute">transition</span>: <span class="number">0.5s</span>;</span><br><span class="line">    &amp;<span class="selector-class">.display</span> &#123;<span class="attribute">right</span>: <span class="number">10px</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.percentage</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">48px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">48px</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">48px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#555</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    &amp;:before &#123;<span class="attribute">content</span>:attr(data-percent);&#125;</span><br><span class="line"><span class="comment">/*    &amp;:hover:before &#123;</span></span><br><span class="line"><span class="comment">        display: inline-block;</span></span><br><span class="line"><span class="comment">        font: normal normal normal 14px/1 FontAwesome;</span></span><br><span class="line"><span class="comment">        font-size: inherit;</span></span><br><span class="line"><span class="comment">        text-rendering: auto;</span></span><br><span class="line"><span class="comment">        -webkit-font-smoothing: antialiased;</span></span><br><span class="line"><span class="comment">        -moz-osx-font-smoothing: grayscale;</span></span><br><span class="line"><span class="comment">        content: "\f176";</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>被注释内容和下面<code>totop.js</code>最后的<code>hover()</code>不能同时用。如果上面的注释取消掉的话，下面的<code>hover()</code>就得整个删掉。其实两个的效果是相同的，都是在触发按钮的<code>hover</code>事件时给它改成图标。</p><figure class="highlight js"><figcaption><span>totop.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bigfa_scroll = &#123;</span><br><span class="line">    drawCircle: <span class="function"><span class="keyword">function</span>(<span class="params">id, percentage, color</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> width = $(id).width();</span><br><span class="line">        <span class="keyword">var</span> height = $(id).height();</span><br><span class="line">        <span class="keyword">var</span> radius = <span class="built_in">parseInt</span>(width / <span class="number">2.20</span>);</span><br><span class="line">        <span class="keyword">var</span> position = width;</span><br><span class="line">        <span class="keyword">var</span> positionBy2 = position / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">var</span> bg = $(id)[<span class="number">0</span>];</span><br><span class="line">        id = id.split(<span class="string">"#"</span>);</span><br><span class="line">        <span class="keyword">var</span> ctx = bg.getContext(<span class="string">"2d"</span>);</span><br><span class="line">        <span class="keyword">var</span> imd = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">var</span> circ = <span class="built_in">Math</span>.PI * <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">var</span> quart = <span class="built_in">Math</span>.PI / <span class="number">2</span>;</span><br><span class="line">        ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">        ctx.beginPath();</span><br><span class="line">        ctx.strokeStyle = color;</span><br><span class="line">        ctx.lineCap = <span class="string">"square"</span>;</span><br><span class="line">        ctx.closePath();</span><br><span class="line">        ctx.fill();</span><br><span class="line">        ctx.lineWidth = <span class="number">3</span>;</span><br><span class="line">        imd = ctx.getImageData(<span class="number">0</span>, <span class="number">0</span>, position, position);</span><br><span class="line">        <span class="keyword">var</span> draw = <span class="function"><span class="keyword">function</span>(<span class="params">current, ctxPass</span>) </span>&#123;</span><br><span class="line">            ctxPass.putImageData(imd, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">            ctxPass.beginPath();</span><br><span class="line">            ctxPass.arc(positionBy2, positionBy2, radius, -(quart), ((circ) * current) - quart, <span class="literal">false</span>);</span><br><span class="line">            ctxPass.stroke();</span><br><span class="line">        &#125;</span><br><span class="line">        draw(percentage / <span class="number">100</span>, ctx);</span><br><span class="line">    &#125;,</span><br><span class="line">    backToTop: <span class="function"><span class="keyword">function</span>(<span class="params">$this</span>) </span>&#123;</span><br><span class="line">        $<span class="keyword">this</span>.click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            $(<span class="string">"body,html"</span>).animate(&#123;</span><br><span class="line">                scrollTop: <span class="number">0</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="number">800</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    scrollHook: <span class="function"><span class="keyword">function</span>(<span class="params">$this, color</span>) </span>&#123;</span><br><span class="line">        color = color ? color: <span class="string">"#000000"</span>;</span><br><span class="line">        $<span class="keyword">this</span>.scroll(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> docHeight = ($(<span class="built_in">document</span>).height() - $(<span class="built_in">window</span>).height()),</span><br><span class="line">            $windowObj = $<span class="keyword">this</span>,</span><br><span class="line">            $per = $(<span class="string">".percentage"</span>),</span><br><span class="line">            percentage = <span class="number">0</span>;</span><br><span class="line">            defaultScroll = $windowObj.scrollTop();</span><br><span class="line">            percentage = <span class="built_in">parseInt</span>((defaultScroll / docHeight) * <span class="number">100</span>);</span><br><span class="line">            <span class="keyword">var</span> backToTop = $(<span class="string">"#backtoTop"</span>);</span><br><span class="line">            <span class="keyword">if</span> (backToTop.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> ($windowObj.scrollTop() &gt; <span class="number">200</span>) &#123;</span><br><span class="line">                    backToTop.addClass(<span class="string">"display"</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    backToTop.removeClass(<span class="string">"display"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                $per.attr(<span class="string">"data-percent"</span>, percentage);</span><br><span class="line">                bigfa_scroll.drawCircle(<span class="string">"#backtoTopCanvas"</span>, percentage, color);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> T = bigfa_scroll,</span><br><span class="line">        totop = $(<span class="string">"#backtoTop"</span>),</span><br><span class="line">        percent = totop.children(<span class="string">".percentage"</span>);</span><br><span class="line">    T.backToTop(totop);</span><br><span class="line">    T.scrollHook($(<span class="built_in">window</span>), <span class="string">"#99ccff"</span>);</span><br><span class="line">    percent.hover(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        percent.addClass(<span class="string">"fa-long-arrow-up"</span>);</span><br><span class="line">        percent.css(&#123;<span class="string">"font-family"</span>:<span class="string">"FontAwesome"</span>&#125;);</span><br><span class="line">    &#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        percent.removeClass(<span class="string">"fa-long-arrow-up"</span>);</span><br><span class="line">        percent.removeAttr(<span class="string">"style"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>将其插入到合适的地方即可。</p><h3 id="目录样式">目录样式</h3><p>首先，来探索Hexo自带helper<code>toc()</code>生成的目录的HTML（该部分目录摘自我的博客<a href="https://unnamed42.github.io/2016-06-22-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86-%E6%A0%88.html">二叉树的遍历-栈</a>）：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ol</span> <span class="attr">class</span>=<span class="string">"toc"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-2"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#直接遍历算法"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>直接遍历算法<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ol</span> <span class="attr">class</span>=<span class="string">"toc-child "</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-3"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#有关约定"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>有关约定<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-3"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#使用系统栈"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>使用系统栈<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ol</span> <span class="attr">class</span>=<span class="string">"toc-child "</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-4"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#前序遍历"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>前序遍历<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-4"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#中序遍历"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>中序遍历<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-4"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#后序遍历"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>后序遍历<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-3"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#使用自定义栈"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>使用自定义栈<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ol</span> <span class="attr">class</span>=<span class="string">"toc-child "</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-4"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#前序遍历-v2"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>前序遍历<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-4"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#中序遍历-v2"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>中序遍历<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-4"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#后序遍历-v2"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>后序遍历<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">ol</span> <span class="attr">class</span>=<span class="string">"toc-child"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-5"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#仙术"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>仙术<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br></pre></td></tr></table></figure><p>分层非常明显。每个链接的目的地就是对应的heading, heading的id就是链接地址去掉<code>#</code>. 各个markdown渲染器生成的结果虽然会有些许不同，但链接和id一定是对应的（Hexo的<code>toc()</code>就是根据heading的id来生成目录的，不对应的话要么没有目录，要么链接目的地是<code>undefined</code>）。</p><p>除此之外，还可以给目录做个外层包装。在本主题中，目录被包裹在<code>&lt;div id=&quot;toc&quot;&gt;&lt;/div&gt;</code>内。</p><p>我给目录定下了几个样式上的目标：</p><ol><li><p>跟随页面滚动</p></li><li><p>当滚动到某个标题时，目录的对应链接要被高亮。</p></li></ol><p>跟随页面滚动这个比较好做，保持<code>position: fixed</code>然后设置好<code>left</code>/<code>right</code>, <code>top</code>/<code>bottom</code>就好。但是仍然会有些许问题，比如滚动到文章底部时目录还能继续向下跟随移动，而且<code>top</code>无法自适应变化(在本主题中，导航栏高55px, 目录希望距离顶部35px因此<code>top</code>的初值是90px. 而90px的<code>top</code>滚动到文章区时无疑太大了)。像这样动态设置位置，只能依赖脚本。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> toc = $(<span class="string">"#toc"</span>), post = $(<span class="string">".post-body"</span>);</span><br><span class="line">    <span class="keyword">var</span> post_height = post.position().top + post.outerHeight(),</span><br><span class="line">        toc_height = toc.height(),</span><br><span class="line">        pos_max = post_height - toc_height;</span><br><span class="line">    $(<span class="built_in">window</span>).scroll(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> scroll_top = $(<span class="built_in">window</span>).scrollTop();</span><br><span class="line">        toc.css(<span class="string">"top"</span>, scroll_top&lt;<span class="number">55</span>? <span class="number">90</span>-scroll_top: (pos_max&gt;scroll_top? <span class="number">35</span>: pos_max-scroll_top));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>其中，<code>post-body</code>是包裹文章的<code>div</code>, <code>post_height</code>就是文章区域底部的位置。使用这段脚本，就可以解决问题1了。</p><p>问题2的解决就比较麻烦了，好在有别的插件可用。经过我一番搜寻，实现了类似于Bootstrap里<code>scrollspy()</code>类似功能的轮子不少，但是没几个能用的（也许是我不会用？）。在Github上面的那几个（<a href="https://github.com/r3plica/Scrollspy" target="_blank" rel="noopener">r3plica/Scrollspy</a>, <a href="https://github.com/thesmart/jquery-scrollspy" target="_blank" rel="noopener">thesmart/jquery-scrollspy</a>, <a href="https://github.com/softwarespot/jquery-scrollspy" target="_blank" rel="noopener">softwarespot/jquery-scrollspy</a>, <a href="https://github.com/sxalexander/jquery-scrollspy" target="_blank" rel="noopener">sxalexander/jquery-scrollspy</a>）都没有起效；而<a href="https://github.com/jgallen23/toc" target="_blank" rel="noopener">jgallen23/toc</a>虽然有点小bug但也能用，不过最大的问题是，它的目录是附送的代码动态生成的，各个HTML的class都和我现在的目录样式的class不一样，我要是配合它还得改css. 出于一种懒人的心态，我没有去用它。</p><p>最终，我还是屈服于Bootstrap的淫威之下。在代码里插入Bootstrap的<a href="http://getbootstrap.com/javascript/#scrollspy" target="_blank" rel="noopener">scrollspy.js</a>, 然后写这么一段脚本：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="string">"#toc ol"</span>).addClass(<span class="string">"nav"</span>);</span><br><span class="line">    $(<span class="string">".toc-item"</span>).on(<span class="string">"activate.bs.scrollspy"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> tocTop = toc.scrollTop(),</span><br><span class="line">            link = $(<span class="keyword">this</span>).children(<span class="string">".toc-link"</span>),</span><br><span class="line">            thisTop = link.position().top;</span><br><span class="line">        <span class="comment">// make sure the highlighted element contains no child</span></span><br><span class="line">        <span class="keyword">if</span>($(<span class="keyword">this</span>).height() != link.height())</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">// if the highlighted element is above current view of toc</span></span><br><span class="line">        <span class="keyword">if</span>(thisTop &lt;= <span class="number">0</span>)</span><br><span class="line">            toc.scrollTop(tocTop + thisTop);</span><br><span class="line">        <span class="comment">// else if below current view of toc</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(tocHeight &lt;= thisTop) </span><br><span class="line">            toc.scrollTop(tocTop + thisTop + link.outerHeight() - tocHeight);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>添加<code>nav</code>这个class, 是因为目前的Bootstrap使用<code>scrollspy()</code>的时候要求目标有<code>nav</code>这个class, 在开发中的v4版Bootstrap就没有这个要求了。使用这个之后，滚动到对应标题，目录里的链接以及它的上级标题的链接会添加一个<code>active</code>的class, 退出这段区域时删除class. 可以据此设置高亮。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#toc</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">5%</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">20%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">90%</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">90px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="selector-tag">i</span> <span class="keyword">in</span> (<span class="number">1</span>..<span class="number">6</span>) &#123;</span><br><span class="line">    .toc-level-&#123;i&#125; <span class="selector-class">.toc-text</span> &#123;<span class="attribute">margin-left</span>: i em;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.toc-text</span> &#123;<span class="attribute">white-space</span>: nowrap;&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.toc-link</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#999</span>;</span><br><span class="line">    <span class="attribute">display</span>: inline-block; <span class="comment">// stretch to parent height</span></span><br><span class="line">    &amp;:hover &#123;<span class="attribute">text-decoration</span>: none;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.toc</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1.8em</span>;</span><br><span class="line">    <span class="attribute">overflow-y</span>: auto;</span><br><span class="line">    <span class="attribute">overflow-x</span>: hidden;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.toc-child</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding-left</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.toc-item</span> &#123;</span><br><span class="line">    <span class="attribute">list-style-type</span>: none;</span><br><span class="line">    &amp;:hover &gt; <span class="selector-class">.toc-link</span> &#123;<span class="attribute">border-left</span>: <span class="number">1px</span> solid <span class="variable">$color</span>-theme;&#125;</span><br><span class="line">    &amp;<span class="selector-class">.active</span> &#123;</span><br><span class="line">        &gt; <span class="selector-class">.toc-link</span> &#123;</span><br><span class="line">            <span class="attribute">color</span>: <span class="variable">$color</span>-theme;</span><br><span class="line">            <span class="attribute">border-left</span>: <span class="number">2px</span> solid <span class="variable">$color</span>-theme;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我是仿照Bootstrap官网的目录做的样式。要注意层级缩进的时候要使用<code>margin-left</code>, 如果使用<code>padding-left</code>那么被高亮时左边边框无法对齐。<code>$color-theme</code>填一个你喜欢的颜色即可。</p><p>如果还想和Bootstrap的更像，只显示当前视图范围内的刺激标题，其余的收拢在最高级标题里，那么再加上这段css：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.toc-child</span> &#123; <span class="attribute">display</span>: none; &#125;</span><br><span class="line"><span class="selector-class">.toc-item</span><span class="selector-class">.active</span> <span class="selector-class">.toc-child</span> &#123; <span class="attribute">display</span>: block; &#125;</span><br></pre></td></tr></table></figure><p>大功告成。</p><h3 id="脚注样式">脚注样式</h3><p>由于默认渲染器<code>hexo-renderer-marked</code>不支持footnote语法，所以为了使用脚注，必须将markdown渲染器换到<code>hexo-renderer-markdown-it</code>, 并开启<code>markdown-it</code>插件。</p><p>其使用方式就是</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Test [^1]</span><br><span class="line">[<span class="symbol">^1</span>]: <span class="link">Footnote</span></span><br></pre></td></tr></table></figure><p>生成对应的html文档是</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Test</span><br><span class="line">    <span class="tag">&lt;<span class="name">sup</span> <span class="attr">class</span>=<span class="string">"footnote-ref"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#fn1"</span> <span class="attr">id</span>=<span class="string">"fnref1"</span>&gt;</span>[1]<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span> <span class="attr">class</span>=<span class="string">"footnotes-sep"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"footnotes"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ol</span> <span class="attr">class</span>=<span class="string">"footnotes-list"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"fn1"</span> <span class="attr">class</span>=<span class="string">"footnote-item"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>Footnote <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#fnref1"</span> <span class="attr">class</span>=<span class="string">"footnote-backref"</span>&gt;</span>↩<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然而这样的话，要看脚注就要跳来跳去地看，比较影响正常的阅读。在我在网上苦苦寻求了一阵之后，我看到了一个<a href="http://tympanus.net/codrops/2014/10/07/tooltip-styles-inspiration/" target="_blank" rel="noopener">很酷炫的tooltip样式</a>（你们可以上<a href="http://tympanus.net/Development/TooltipStylesInspiration/" target="_blank" rel="noopener">Demo</a>来感受一下），因此我决定把脚注改成这个样子的。</p><p>既然都是这种样式的了那后面的脚注内容（分割线<code>footnotes-sep</code>和脚注内容<code>footnotes</code>）都不需要了。首先上样式表：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.footnotes-sep</span>, <span class="selector-class">.footnotes</span> &#123;<span class="attribute">display</span>: none;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Style from https://github.com/codrops/TooltipStylesInspiration */</span></span><br><span class="line"><span class="selector-class">.footnote-ref</span> &#123;</span><br><span class="line">    <span class="attribute">vertical-align</span>: super;</span><br><span class="line">    <span class="attribute">font-size</span>: smaller;</span><br><span class="line">    <span class="attribute">display</span>: inline;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    &amp;<span class="selector-class">.active</span> &#123;</span><br><span class="line">        <span class="selector-tag">a</span>:after &#123; <span class="attribute">pointer-events</span>: auto;&#125;</span><br><span class="line">        <span class="selector-class">.fn-content</span> &#123;</span><br><span class="line">            <span class="attribute">pointer-events</span>: auto;</span><br><span class="line">            <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">            -webkit-<span class="attribute">transform</span>: translate3d(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>) rotate3d(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">            <span class="attribute">transform</span>: translate3d(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>) rotate3d(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &gt; <span class="selector-tag">a</span> &#123;</span><br><span class="line">        <span class="attribute">cursor</span>: pointer;</span><br><span class="line">        <span class="attribute">display</span>: inline-block;</span><br><span class="line">        <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">        &amp;:after &#123;</span><br><span class="line">            <span class="attribute">content</span>: <span class="string">''</span>;</span><br><span class="line">            <span class="attribute">position</span>: absolute;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">360px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">20px</span>;</span><br><span class="line">            <span class="attribute">bottom</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">            <span class="attribute">pointer-events</span>: none;</span><br><span class="line">            -webkit-<span class="attribute">transform</span>: translateX(-<span class="number">50%</span>);</span><br><span class="line">            <span class="attribute">transform</span>: translateX(-<span class="number">50%</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.fn-content</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">14</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1.4</span>;</span><br><span class="line">    <span class="attribute">box-shadow</span>: -<span class="number">5px</span> -<span class="number">5px</span> <span class="number">15px</span> rgba(<span class="number">48</span>,<span class="number">54</span>,<span class="number">61</span>,<span class="number">0.2</span>);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">0.5em</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#2a3035</span>;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">pointer-events</span>: none;</span><br><span class="line">    -webkit-<span class="attribute">transform</span>: translate3d(<span class="number">0</span>,-<span class="number">10px</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="attribute">transform</span>: translate3d(<span class="number">0</span>,-<span class="number">10px</span>,<span class="number">0</span>);</span><br><span class="line">    -webkit-<span class="attribute">transition</span>: opacity <span class="number">0.3s</span>, -webkit-transform <span class="number">0.3s</span>;</span><br><span class="line">    <span class="attribute">transition</span>: opacity <span class="number">0.3s</span>, transform <span class="number">0.3s</span>;</span><br><span class="line">    <span class="comment">/* Arrow */</span></span><br><span class="line">    &amp;:after &#123;</span><br><span class="line">        <span class="attribute">content</span>: <span class="string">''</span>;</span><br><span class="line">        <span class="attribute">top</span>: <span class="number">100%</span>;</span><br><span class="line">        <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">        <span class="attribute">border</span>: solid transparent;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">position</span>: absolute;</span><br><span class="line">        <span class="attribute">pointer-events</span>: none;</span><br><span class="line">        <span class="attribute">border-color</span>: transparent;</span><br><span class="line">        <span class="attribute">border-top-color</span>: <span class="number">#2a3035</span>;</span><br><span class="line">        <span class="attribute">border-width</span>: <span class="number">10px</span>;</span><br><span class="line">        <span class="attribute">margin-left</span>: -<span class="number">10px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.fn-text</span> &#123;</span><br><span class="line">        <span class="attribute">line-height</span>: <span class="number">1.35</span>;</span><br><span class="line">        <span class="attribute">display</span>: inline-block;</span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">1.31em</span> <span class="number">1.21em</span> <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">font-size</span>: <span class="number">14.5px</span>;</span><br><span class="line">        <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">        <span class="attribute">z-index</span>: <span class="number">8</span>;</span><br><span class="line">        <span class="selector-tag">a</span> &#123;<span class="attribute">font-weight</span>: bold;&#125;</span><br><span class="line">        <span class="comment">/* p &#123;margin-bottom: 0;&#125;*/</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>首先我们得生成我们需要的html, 改markdown渲染器代码虽然一劳永逸，但太麻烦了，我们可以使用jQuery来生成tooltip的代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="string">".footnote-ref"</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> id = $(<span class="keyword">this</span>).children(<span class="string">"a"</span>).attr(<span class="string">"href"</span>).substr(<span class="number">1</span>),</span><br><span class="line">            footnote = $(<span class="built_in">document</span>.getElementById(id)),</span><br><span class="line">            outer_wrapper = $(<span class="string">"&lt;span&gt;"</span>,&#123;<span class="string">"class"</span>:<span class="string">"fn-content"</span>&#125;),</span><br><span class="line">            inner_wrapper = $(<span class="string">"&lt;span&gt;"</span>,&#123;<span class="string">"class"</span>:<span class="string">"fn-text"</span>&#125;);</span><br><span class="line">        footnote.find(<span class="string">".footnote-backref"</span>).remove();</span><br><span class="line">        $(<span class="keyword">this</span>).append(outer_wrapper.append(inner_wrapper.html(footnote.html())));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>footnote-backref</code>是脚注部分返回的小图标，放在脚注tooltip里绝对不好看，也不合理。因此，我选择干掉它。</p><p>其实上面的样式和原来的相比，差了<code>width</code>和<code>margin-left</code>两个，这两个我准备用js来动态调整。由于脚注文字有多有少，直接统一一个很大的<code>width</code>对于文字少的来说有一大片空白，相当不好看，而且在手机上会溢出屏幕。而<code>margin-left</code>应该为<code>width</code>一半的负值，来保证tooltip处于脚注链接的正上方。如果改了<code>width</code>的话，<code>margin-left</code>也要跟着改变。</p><p>其实对于文字少的来说，外层<code>span</code>的<code>width</code>不会变，但内层<code>span</code>的<code>width</code>是会跟着文字量改变的。据此我们不用自己计算<code>width</code>, 等浏览器绘制完毕直接把这个值拿来用就行。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> position = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> content = $(<span class="string">".fn-content"</span>).removeAttr(<span class="string">"style"</span>);</span><br><span class="line">        <span class="keyword">if</span>($(<span class="built_in">window</span>).width() &lt; <span class="number">640</span>)</span><br><span class="line">            content.css(<span class="string">"width"</span>,$(<span class="built_in">window</span>).width()/<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            content.css(<span class="string">"width"</span>,<span class="number">340</span>); <span class="comment">// default value</span></span><br><span class="line">        content.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> width = $(<span class="keyword">this</span>).children(<span class="string">".fn-text"</span>).outerWidth();</span><br><span class="line">            $(<span class="keyword">this</span>).css(&#123;</span><br><span class="line">                <span class="string">"width"</span>: width,</span><br><span class="line">                <span class="string">"margin-left"</span>: width/<span class="number">-2</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    position();</span><br><span class="line">    $(<span class="built_in">window</span>).resize(position());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>因为要根据屏幕大小确定<code>width</code>初始值，所以这个函数不光在<code>document</code>加载完毕后要执行，<code>window</code>改变大小的时候也要跟着执行。</p><p>解决完了样式的事情我们再来解决显示的事情。我希望的是点击脚注链接它要显示，再次点击时消失，点击别处也要消失（包括点击其他的脚注链接）。因此不能用<code>$(&quot;.footnote-ref&quot;).click()</code>来实现，而要通过整个<code>document</code>的点击事件来实现。这个点击的判断我们可以直接摘抄<a href="https://stackoverflow.com/a/2364639" target="_blank" rel="noopener">Stack Overflow</a>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="built_in">document</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params">t</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> target = $(<span class="string">".fn-content"</span>),</span><br><span class="line">            clicked = $(t.target);</span><br><span class="line">        <span class="keyword">if</span>(target.is(clicked) || target.has(clicked).length != <span class="number">0</span>)</span><br><span class="line">            t.stopPropagation();</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> parent = clicked.parents(<span class="string">".footnote-ref"</span>),</span><br><span class="line">                active = $(<span class="string">".footnote-ref.active"</span>);</span><br><span class="line">            <span class="keyword">if</span>(!active.is(parent))</span><br><span class="line">                active.removeClass(<span class="string">"active"</span>);</span><br><span class="line">            <span class="keyword">if</span>(!parent.length)&#123;</span><br><span class="line">                parent.hasClass(active)?parent.removeClass(<span class="string">"active"</span>):parent.addClass(<span class="string">"active"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>将以上几段js合体（假设你放到的是<code>js/footnote.js</code>），插入到有脚注的页面即可。可以使用这个简单的Hexo插件来实现，也可以简单粗暴地在所有页面都插入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hexo.extend.filter.register(<span class="string">'after_post_render'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(data.content.indexOf(<span class="string">"#fn"</span>) != <span class="number">-1</span>)&#123;</span><br><span class="line">        data.content += <span class="string">"&lt;script src=\"js/footnote.js\" type=\"text/javascript\"&gt;&lt;/script&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>其实还有别的脚注tooltip化方案，比如<a href="http://www.bigfootjs.com/" target="_blank" rel="noopener">bigfoot.js</a>或者是<a href="http://syeong.jcsg.com/2012/07/07/footnote-tooltips/" target="_blank" rel="noopener">这篇博客</a>介绍的方案，但是前者体积太大。后者我看着感觉不错。</p><h3 id="在js插件中访问设置">在js插件中访问设置</h3><p>使用<code>hexo.config</code>来访问站点设置，<code>hexo.theme.config</code>来访问主题设置。</p><h3 id="根据设置生成css">根据设置生成CSS</h3><p>在Stylus里使用<code>hexo-config(entry)</code>能获取<strong>主题设置</strong>里的<code>entry</code>条目内容。可以使用这个功能根据设置生成不同的CSS, 而不用预先给你的<code>&lt;div&gt;</code>设置上好几个<code>class</code>来调整外观。</p><p><code>hexo-config</code>的定义在<a href="https://github.com/hexojs/hexo-renderer-stylus/" target="_blank" rel="noopener"><code>hexo-renderer-stylus</code></a>里如下：</p><figure class="highlight js"><figcaption><span>https://github.com/hexojs/hexo-renderer-stylus/blob/master/lib/renderer.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">defineConfig</span>(<span class="params">style</span>) </span>&#123;</span><br><span class="line">  style.define(<span class="string">'hexo-config'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> getProperty(self.theme.config, data.val);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="自定义页面生成">自定义页面生成</h3><p>将下面的js放到主题文件夹下的<code>scripts</code>文件夹里，文件名随意。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"></span><br><span class="line">hexo.extend.generator.register(some_name,<span class="function"><span class="keyword">function</span>(<span class="params">locals</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        path: page_path,</span><br><span class="line">        data: &#123;&#125;,</span><br><span class="line">        layout: page_layout</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>细节解释如下：</p><ul><li><code>some_name</code>是一个<code>String</code>, 原则上这个名字可以随便填。但是Hexo自己已经占用了<code>asset</code>, <code>page</code>, <code>post</code>这三个，所以除此之外都可以。</li><li><code>data</code>代表除页面模板之外的页面内容。<strong>并非字符串</strong>。</li><li><code>page_path</code>是一个<code>String</code>, 内容应该是该网页相对根的路径，不包含代表根目录的<code>/</code>.</li><li><code>page_layout</code>是<code>String</code>或<code>String</code>的<code>Array</code>, 代表该页面使用的<code>layout</code>.</li></ul><p>示例，比如我要想生成404页面（已经写好了<code>404.ejs</code>）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hexo.extend.generator.register(<span class="string">'_404'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">locals</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        path: <span class="string">'404.html'</span>,</span><br><span class="line">        data: &#123;&#125;,</span><br><span class="line">        layout: [<span class="string">'404'</span>,<span class="string">'layout'</span>]</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>这样Hexo就会根据<code>layout/404.ejs</code>的模板在网站根目录下生成<code>404.html</code>. 如果找不到<code>404.ejs</code>的话，就会转而使用<code>layout.ejs</code>模板。</p><p>还可以同时生成多个页面：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hexo.extend.generator.register(some_name,<span class="function"><span class="keyword">function</span>(<span class="params">locals</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        &#123;<span class="attr">path</span>: page_path1,<span class="attr">data</span>: &#123;&#125;,<span class="attr">layout</span>: page_layout1&#125;,</span><br><span class="line">        &#123;<span class="attr">path</span>: page_path2,<span class="attr">data</span>: &#123;&#125;,<span class="attr">layout</span>: page_layout2&#125;,</span><br><span class="line">        &#123;<span class="attr">path</span>: page_path3,<span class="attr">data</span>: &#123;&#125;,<span class="attr">layout</span>: page_layout3&#125;</span><br><span class="line">    ];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>这样做的好处就是，举例来说，不需要用户自己去写一个<code>404.md</code>来使用404页面，自动就能生成。</p><h3 id="选择性生成css或js">选择性生成css或js</h3><p>比如，我在主题的<code>source/js</code>文件夹下放了<code>duoshuo.min.js</code>这个多说本地化脚本，当设置里没启用多说的时候这个js文件还是会跟着生成，跟着发布到你的博客服务器上，浪费流量。该怎么办呢？</p><p>把如下js放进主题的<code>scripts</code>文件夹下（文件名随意）：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line">hexo.extend.filter.register(<span class="string">'after_generate'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> duoshuo = hexo.theme.config.duoshuo_shortname;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(!duoshuo || duoshuo.length == <span class="number">0</span>)&#123;</span><br><span class="line">        hexo.route.remove(<span class="string">'js/duoshuo.min.js'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>其中<code>duoshuo_shortname</code>是主题设置里的一个条目。</p><p>这样，当<code>duoshuo_shortname</code>为空时，<code>duoshuo.min.js</code>不会跟着生成，从而减少所需加载量。</p><h3 id="html分块">HTML分块</h3><p>你可以将经常变动，而使用又非常频繁的部分单独拿出来，使用<a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A1%B5%E9%9D%A2%E7%94%9F%E6%88%90">上面提到的技巧</a>生成一个单独的页面，使用jQuery来加载它。</p><p>以我的主题为例，“最近文章”这个插件属于侧边栏，而侧边栏几乎在每个页面里面都有。每当post有哪怕一个很小的改动，“最近文章”就需要更新，导致侧边栏内容需要重新生成，进而导致所有的页面全部重新生成。将它单独拿出来，就可以避免这一情况发生。</p><p>首先，生成一个单独的页面<code>/components/recent-posts.html</code>.</p><figure class="highlight plain"><figcaption><span>recent_posts.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">layout: none</span><br><span class="line">---</span><br><span class="line">&lt;% if (site.posts.length)&#123; %&gt;</span><br><span class="line">    &lt;h3&gt;&lt;%= __(&apos;recent_posts&apos;) %&gt;&lt;/h3&gt;</span><br><span class="line">    &lt;ul class=&quot;list&quot;&gt;</span><br><span class="line">        &lt;% site.posts.sort(&apos;updated&apos;, -1).limit(8).each(function(post)&#123; %&gt;</span><br><span class="line">        &lt;li&gt;</span><br><span class="line">            &lt;p&gt;&lt;a href=&quot;&lt;%- url_for(post.path) %&gt;&quot; class=&quot;tooltipped tooltipped-n&quot; aria-label=&quot;&lt;%= post.title || __(&apos;untitled&apos;) %&gt;&quot;&gt;&lt;%= truncate(post.title || __(&apos;untitled&apos;),&#123;length: 23,omission:&quot;...&quot;&#125;) %&gt;&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">            &lt;p&gt;&lt;%= __(&apos;updated&apos;) + __(&apos;:&apos;) %&gt;</span><br><span class="line">            &lt;span class=&quot;update-time&quot;&gt;&lt;%= post.updated.format(&apos;YYYY-MM-D h:m a&apos;) %&gt;&lt;/span&gt;&lt;/p&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;% &#125;) %&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><p>里面的<code>layout: none</code>非常关键，因为我们只想要这一个部分而不是一个完整的网页。</p><p>此时插入这个插件就不能使用<code>&lt;%- partial('_widget/recent_posts') %&gt;</code>来插入，而是使用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Something before --&gt;</span><br><span class="line">&lt;% if (site.posts.length)&#123; %&gt;</span><br><span class="line">&lt;div class=&quot;widget recent-posts&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line">&lt;!-- Something after --&gt;</span><br></pre></td></tr></table></figure><p>并且插入这样一段脚本：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="string">".widget.recent_posts"</span>).load(<span class="string">"/components/recent-posts.html"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>如果还想对html做点什么修改的话，改成：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="string">".widget.recent_posts"</span>).load(<span class="string">"/components/recent-posts.html"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">response,status</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(status === <span class="string">"success"</span>)&#123;</span><br><span class="line">            <span class="comment">// something</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="hexo插件使用">Hexo插件使用</h2><h3 id="hexo-generator-search">hexo-generator-search</h3><p>一个基于jQuery的本地搜索插件。它本身不提供搜索功能，它所做的只是生成博客内所有页面的索引。该插件提供的搜索内容相当于Hexo生成阶段的<code>post.content</code>. 在<a href="http://hahack.com/codes/local-search-engine-for-hexo/" target="_blank" rel="noopener">作者博客</a>那边的代码里有个小错误，它会导致搜索返回的匹配字符串异常地长。</p><p>既然我都把这个单独拿出来了那肯定就要做一点自己的改进了。作者提供的代码是直接去掉所有html tag再搜索，但有一点缺陷，就是存放在<code>&lt;script&gt;</code>和<code>&lt;style&gt;</code>里的内容也会被算进搜索范围内，还有就是代码高亮的行号也会被算在内。针对这一点，我们在搜索之前利用jQuery干掉这些内容：</p><p>默认情况下，Hexo的行号是静态生成好的，而且被<code>&lt;td class=&quot;gutter&quot;&gt;</code>包着。删去<code>$(&quot;.gutter&quot;)</code>就可以了。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stripper</span>(<span class="params">content</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> wrapper = $(<span class="string">"&lt;div&gt;"</span>+ content +<span class="string">"&lt;/div&gt;"</span>);</span><br><span class="line">    wrapper.find(<span class="string">"script,style"</span>).remove();</span><br><span class="line">    $(<span class="string">".gutter"</span>,wrapper).remove();</span><br><span class="line">    <span class="keyword">return</span> wrapper.html();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>剩下的搜索代码，可以使用作者提供的：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> searchFunc = <span class="function"><span class="keyword">function</span>(<span class="params">path, search_id, content_id</span>) </span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span>;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url: path,</span><br><span class="line">        dataType: <span class="string">"xml"</span>,</span><br><span class="line">        success: <span class="function"><span class="keyword">function</span>(<span class="params"> xmlResponse </span>) </span>&#123;</span><br><span class="line">            <span class="comment">// get the contents from search data</span></span><br><span class="line">            <span class="keyword">var</span> datas = $( <span class="string">"entry"</span>, xmlResponse ).map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    title: $( <span class="string">"title"</span>, <span class="keyword">this</span> ).text(),</span><br><span class="line">                    content: stripper($(<span class="string">"content"</span>,<span class="keyword">this</span>).text()),</span><br><span class="line">                    url: $( <span class="string">"url"</span> , <span class="keyword">this</span>).text()</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;).get();</span><br><span class="line">            <span class="keyword">var</span> $input = <span class="built_in">document</span>.getElementById(search_id);</span><br><span class="line">            <span class="keyword">var</span> $resultContent = <span class="built_in">document</span>.getElementById(content_id);</span><br><span class="line">            $input.addEventListener(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">var</span> str=<span class="string">'&lt;ul class=\"search-result-list\"&gt;'</span>;                </span><br><span class="line">                <span class="keyword">var</span> keywords = <span class="keyword">this</span>.value.trim().toLowerCase().split(<span class="regexp">/[\s\-]+/</span>);</span><br><span class="line">                $resultContent.innerHTML = <span class="string">""</span>;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.value.trim().length &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// perform local searching</span></span><br><span class="line">                datas.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">var</span> isMatch = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">var</span> content_index = [];</span><br><span class="line">                    <span class="keyword">var</span> data_title = data.title.trim().toLowerCase();</span><br><span class="line">                    <span class="keyword">var</span> data_content = data.content.trim().replace(<span class="regexp">/&lt;[^&gt;]+&gt;/g</span>,<span class="string">""</span>).toLowerCase();</span><br><span class="line">                    <span class="keyword">var</span> data_url = data.url;</span><br><span class="line">                    <span class="keyword">var</span> index_title = <span class="number">-1</span>;</span><br><span class="line">                    <span class="keyword">var</span> index_content = <span class="number">-1</span>;</span><br><span class="line">                    <span class="keyword">var</span> first_occur = <span class="number">-1</span>;</span><br><span class="line">                    <span class="comment">// only match artiles with not empty titles and contents</span></span><br><span class="line">                    <span class="keyword">if</span>(data_title != <span class="string">''</span> &amp;&amp; data_content != <span class="string">''</span>) &#123;</span><br><span class="line">                        keywords.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">keyword, i</span>) </span>&#123;</span><br><span class="line">                            index_title = data_title.indexOf(keyword);</span><br><span class="line">                            index_content = data_content.indexOf(keyword);</span><br><span class="line">                            <span class="keyword">if</span>( index_title &lt; <span class="number">0</span> &amp;&amp; index_content &lt; <span class="number">0</span> )&#123;</span><br><span class="line">                                isMatch = <span class="literal">false</span>;</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">if</span> (index_content &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                                    index_content = <span class="number">0</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">                                    first_occur = index_content;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// show search results</span></span><br><span class="line">                    <span class="keyword">if</span> (isMatch) &#123;</span><br><span class="line">                        str += <span class="string">"&lt;li&gt;&lt;a href='"</span>+ data_url +<span class="string">"' class='search-result-title'&gt;"</span>+ data_title +<span class="string">"&lt;/a&gt;"</span>;</span><br><span class="line">                        <span class="keyword">var</span> content = data.content.trim().replace(<span class="regexp">/&lt;[^&gt;]+&gt;/g</span>,<span class="string">""</span>);</span><br><span class="line">                        <span class="keyword">if</span> (first_occur &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="comment">// cut out 100 characters</span></span><br><span class="line">                            <span class="keyword">var</span> start = first_occur - <span class="number">20</span>;</span><br><span class="line">                            <span class="keyword">var</span> end = first_occur + <span class="number">80</span>;</span><br><span class="line">                            <span class="keyword">if</span>(start &lt; <span class="number">0</span>)&#123;</span><br><span class="line">                                start = <span class="number">0</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">if</span>(start == <span class="number">0</span>)&#123;</span><br><span class="line">                                end = <span class="number">100</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">if</span>(end &gt; content.length)&#123;</span><br><span class="line">                                end = content.length;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">var</span> match_content = content.substring(start, end); </span><br><span class="line">                            <span class="comment">// highlight all keywords</span></span><br><span class="line">                            keywords.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">keyword</span>)</span>&#123;</span><br><span class="line">                                <span class="keyword">var</span> regS = <span class="keyword">new</span> <span class="built_in">RegExp</span>(keyword, <span class="string">"gi"</span>);</span><br><span class="line">                                match_content = match_content.replace(regS, <span class="string">"&lt;em class=\"search-keyword\"&gt;"</span>+keyword+<span class="string">"&lt;/em&gt;"</span>);</span><br><span class="line">                            &#125;);</span><br><span class="line">                            </span><br><span class="line">                            str += <span class="string">"&lt;p class=\"search-result\"&gt;"</span> + match_content +<span class="string">"...&lt;/p&gt;"</span></span><br><span class="line">                        &#125;</span><br><span class="line">                        str += <span class="string">"&lt;/li&gt;"</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                str += <span class="string">"&lt;/ul&gt;"</span>;</span><br><span class="line">                $resultContent.innerHTML = str;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果你的搜索框插入的是</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"site_search"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"local-search-input"</span> <span class="attr">name</span>=<span class="string">"q"</span> <span class="attr">results</span>=<span class="string">"0"</span> <span class="attr">placeholder</span>=<span class="string">"search my blog..."</span> <span class="attr">class</span>=<span class="string">"form-control"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"local-search-result"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>那么还要在页面当中插入</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> search_path = <span class="string">"&lt;%= config.search.path %&gt;"</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (search_path.length == <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">        search_path = <span class="string">"search.xml"</span>;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> path = <span class="string">"&lt;%= config.root %&gt;"</span> + search_path;</span></span><br><span class="line"><span class="javascript">    searchFunc(path, <span class="string">'local-search-input'</span>, <span class="string">'local-search-result'</span>);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>剩下就是一些css装饰这类的细节工作了。</p><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>2016年 <a href="#fnref1" class="footnote-backref">↩</a></p></li><li id="fn2" class="footnote-item"><p>PHP <a href="#fnref2" class="footnote-backref">↩</a></p></li></ol></section></div></div><div class="license-notice"><span>作者:</span>Dr. A. Clef<br><span>发布日期:</span>2016-09-10<br><span>修改日期:</span>2017-12-06<br><span>发布协议:</span> <a href="https://creativecommons.org/licenses/by-sa/4.0" target="_blank">BY-SA</a></div><nav class="post-tags"><a href="/tags/Hexo/" title="Hexo" rel="tag" class="fa fa-tag">Hexo</a></nav></article></div><!-- div#primary --><ul id="pager"><li class="previous"><a href="/2017-03-16-中国政治坐标系测试.html" title="中国政治坐标系测试（北大未名版）" class="tooltipped tooltipped-n" aria-label="中国政治坐标系测试（北大未名版）"><span class="fa fa-chevron-left"></span> 上一篇文章</a></li><li class="next"><a href="/2016-06-30-官方版DnD阵营测试.html" title="官方版DnD阵营测试" class="tooltipped tooltipped-n" aria-label="官方版DnD阵营测试">下一篇文章 <span class="fa fa-chevron-right"></span></a></li></ul><section id="comments"><!-- disqus start --><div id="disqus_thread" class="disqus-thread"></div><!-- disqus end --></section><nav id="toc" class="sticky"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#主题的创建"><span class="toc-text">主题的创建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#主题模板引擎"><span class="toc-text">主题模板引擎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#主题css预处理器"><span class="toc-text">主题CSS预处理器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#主题结构"><span class="toc-text">主题结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hexo主题相关"><span class="toc-text">Hexo主题相关</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#回到顶部-按钮"><span class="toc-text">“回到顶部”按钮</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#按钮样式"><span class="toc-text">按钮样式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#百分比样式"><span class="toc-text">百分比样式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#目录样式"><span class="toc-text">目录样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#脚注样式"><span class="toc-text">脚注样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在js插件中访问设置"><span class="toc-text">在js插件中访问设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#根据设置生成css"><span class="toc-text">根据设置生成CSS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义页面生成"><span class="toc-text">自定义页面生成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#选择性生成css或js"><span class="toc-text">选择性生成css或js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#html分块"><span class="toc-text">HTML分块</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hexo插件使用"><span class="toc-text">Hexo插件使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hexo-generator-search"><span class="toc-text">hexo-generator-search</span></a></li></ol></li></ol></nav></div></main><!-- Footer --><!-- #content --><footer id="footer"><div class="container"><p><span class="cc-license"><a href="https://creativecommons.org/licenses/by-sa/4.0" target="_blank" title="Creative Commons license by-sa"><span class="cc cc-cc"></span> <span class="cc cc-by"></span> <span class="cc cc-sa"></span></a></span> &nbsp;2015-2018 BUG研发中心.</p><p>Themed by <a href="https://github.com/unnamed42/hexo-theme-kunkka">Kunkka</a> | Powered by <a href="https://hexo.io/">Hexo</a>.</p><div class="sns-icons"><span class="sns-icon fa-stack"><a target="_blank" href="https://github.com/unnamed42"><span class="fa fa-square fa-stack-2x"></span> <span class="fa fa-github fa-stack-1x fa-inverse"></span></a></span> <span class="sns-icon fa-stack"><a target="_blank" href="https://plus.google.com/u/0/101538012089625781458"><span class="fa fa-square fa-stack-2x"></span> <span class="fa fa-google-plus fa-stack-1x fa-inverse"></span></a></span> <span class="sns-icon fa-stack"><a target="_blank" href="https://www.zhihu.com/people/huang-wen-rui-74"><span class="fa fa-square fa-stack-2x"></span> <span class="fa fa-stack-1x fa-inverse">知</span></a></span> <span class="sns-icon fa-stack"><a target="_blank" href="http://tieba.baidu.com/home/main/?un=Xelnagaman"><span class="fa fa-square fa-stack-2x"></span> <span class="fa fa-stack-1x fa-inverse">贴</span></a></span></div></div></footer><!-- #footer --><div id="totop" title="送你上天"><canvas id="totop-canvas" width="48" height="48"></canvas><div id="totop-percent"></div></div></body></html>